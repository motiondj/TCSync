# nDisplay 환경에서 타임코드 플러그인 테스트 가이드 (블루프린트 기반)

## 개요

이 문서는 블루프린트를 사용하여 언리얼 엔진의 nDisplay 시스템과 타임코드 동기화 플러그인을 함께 테스트하는 방법을 설명합니다. nDisplay는 멀티 디스플레이 및 클러스터 환경에서 동기화된 렌더링을 제공하는 언리얼 엔진의 기능입니다. 타임코드 플러그인을 nDisplay와 통합하면 여러 디스플레이 노드 간의 시간 동기화가 가능합니다.

## 사전 요구 사항

- 언리얼 엔진 5.5 이상
- nDisplay 플러그인 활성화
- 타임코드 동기화 플러그인 설치
- 최소 2개 이상의 노드로 구성된 nDisplay 클러스터 환경 (실제 또는 가상)

## 테스트 환경 설정

### 1. nDisplay 구성 파일 준비

**config.ndisplay** 파일에서 다음 내용을 확인하고 설정합니다:

```json
{
  "cluster": {
    "master": "node-0",
    "nodes": [
      {
        "id": "node-0",
        "addr": "192.168.1.100",
        "port": 41001,
        "master": true
      },
      {
        "id": "node-1",
        "addr": "192.168.1.101",
        "port": 41001,
        "master": false
      }
    ]
  },
  "network": {
    "game_start_barrier": true,
    "render_sync_policy": "ethernet",
    "clock_sync": true
  }
}
```

중요 설정:
- `master`: nDisplay 마스터 노드 ID
- `nodes`: 각 nDisplay 노드의 정보
- `clock_sync`: 시간 동기화 활성화 여부 (true로 설정)
- `render_sync_policy`: 렌더링 동기화 방식

### 2. 테스트 프로젝트 설정

1. 언리얼 에디터에서 새 프로젝트 생성 (또는 기존 프로젝트 열기)
2. nDisplay 플러그인 활성화: 편집 → 플러그인 → nDisplay
3. 타임코드 동기화 플러그인 설치: 플러그인 폴더에 복사 후 활성화
4. 프로젝트 설정:
   - 편집 → 프로젝트 설정 → nDisplay → Config File: 앞서 준비한 config.ndisplay 파일 경로 지정
   - 편집 → 프로젝트 설정 → 타임코드 동기화 → 기본 설정 구성

## 블루프린트 테스트 시나리오

### 시나리오 1: nDisplay 역할 자동 감지 테스트 (블루프린트)

**목적**: 타임코드 플러그인이 nDisplay 클러스터의 마스터/슬레이브 역할을 올바르게 감지하는지 확인

**테스트 단계**:

1. 빈 레벨 생성 및 액터 배치
   - 새 레벨을 생성하고 기본 큐브나 구체 액터 배치

2. 액터 블루프린트 생성
   - 콘텐츠 브라우저에서 우클릭 → 블루프린트 클래스 → 액터 선택
   - 이름을 "BP_TimecodeDisplayActor"로 지정

3. 타임코드 컴포넌트 추가
   - 블루프린트 에디터에서 컴포넌트 패널의 "추가 컴포넌트" 버튼 클릭
   - 검색창에 "Timecode" 입력하여 "타임코드 컴포넌트" 추가
   - 텍스트 렌더 컴포넌트도 추가 (타임코드 표시용)

4. 타임코드 컴포넌트 설정
   - 컴포넌트 상세 패널에서:
     - Role Mode: "Automatic Detection"으로 설정
     - Use nDisplay: 체크 (활성화)
     - Frame Rate: 30.0 설정
     - 필요에 따라 다른 설정 조정

5. 역할 감지 로직 구현
   - 이벤트 그래프에서 Event BeginPlay 노드 추가
   - BeginPlay에 다음 로직 연결:
     
     ![nDisplay 역할 감지 블루프린트](https://i.ibb.co/RQc77m8/ndisplay-role-detection-bp.jpg)

   - 이 블루프린트는:
     - 타임코드 컴포넌트 참조 가져오기
     - GetIsMaster 함수로 현재 역할 확인
     - Print String으로 역할 정보 화면에 표시
     - 텍스트 렌더 컴포넌트에 역할 정보 설정

6. nDisplay 클러스터로 프로젝트 실행
   - nDisplay Launcher 사용하여 실행

7. 결과 확인
   - 각 노드의 화면과 로그에서 역할 정보 확인
   - 마스터 노드: "MASTER" 표시
   - 슬레이브 노드: "SLAVE" 표시

### 시나리오 2: 다중 노드 간 타임코드 동기화 테스트 (블루프린트)

**목적**: 여러 nDisplay 노드 간에 타임코드 동기화가 올바르게 이루어지는지 확인

**테스트 단계**:

1. BP_TimecodeDisplayActor 블루프린트 수정
   - 텍스트 렌더 컴포넌트의 크기와 색상 설정 (가시성 향상)
   - 컴포넌트 탭에서 텍스트 렌더 컴포넌트 선택 → 상세 패널:
     - 텍스트 크기: 30.0
     - 텍스트 색상: 밝은 녹색

2. 타임코드 표시 로직 구현
   - 이벤트 그래프에서 Event Tick 노드 추가
   - Tick에 다음 로직 연결:
     
     ![타임코드 동기화 테스트 블루프린트](https://i.ibb.co/XZxv1p3/timecode-display-bp.jpg)

   - 이 블루프린트는:
     - 타임코드 컴포넌트에서 현재 타임코드 가져오기
     - 텍스트 렌더 컴포넌트에 타임코드 표시
     - 노드 ID와 타임코드 함께 로그 출력

3. 이벤트 시스템 추가 (선택 사항)
   - 특정 타임코드에서 이벤트 트리거하는 로직 추가:
     
     ![타임코드 이벤트 트리거 블루프린트](https://i.ibb.co/LdMPmMy/timecode-event-bp.jpg)

   - 이 블루프린트는:
     - BeginPlay에서 타임코드 컴포넌트에 이벤트 등록
     - 이벤트가 트리거되면 화면에 메시지 표시

4. 레벨에 BP_TimecodeDisplayActor 배치
   - 레벨 에디터에서 콘텐츠 브라우저의 BP_TimecodeDisplayActor 드래그 앤 드롭

5. nDisplay 클러스터로 프로젝트 실행
   - 마스터 노드 먼저 시작 후 슬레이브 노드 시작

6. 결과 확인
   - 모든 노드에 표시되는 타임코드 값 비교
   - 초기 동기화 후 타임코드 흐름 일치 확인
   - 로그에서 타임코드 업데이트 메시지 확인

### 시나리오 3: 미디어 동기화 테스트 (블루프린트)

**목적**: 타임코드를 기반으로 여러 nDisplay 노드 간에 미디어 재생이 동기화되는지 확인

**테스트 단계**:

1. 미디어 소스 준비
   - 콘텐츠 브라우저에 비디오 파일 가져오기
   - 미디어 에셋 생성 (예: MediaSource_Test)

2. 미디어 플레이어 블루프린트 생성
   - 새 액터 블루프린트 생성: "BP_TimecodeMediaPlayer"
   - 컴포넌트 추가:
     - 타임코드 컴포넌트
     - 미디어 플레이어 컴포넌트
     - 미디어 사운드 컴포넌트
     - 미디어 텍스처 컴포넌트
     - 평면 스태틱 메시 컴포넌트 (비디오 표시용)
     - 머티리얼 생성하여 미디어 텍스처 연결

3. 미디어 플레이어 설정
   - 미디어 플레이어 컴포넌트 설정:
     - Source: 준비한 미디어 소스 설정
     - Play On Open: 체크 해제
     - Loop: 선택적으로 활성화

4. 타임코드 기반 미디어 제어 로직 구현
   - 이벤트 그래프에서 다음 로직 구현:
     
     ![미디어 동기화 블루프린트](https://i.ibb.co/QpfLq0m/timecode-media-sync-bp.jpg)

   - 이 블루프린트는:
     - BeginPlay에서 미디어 소스 열기
     - 타임코드 변경 이벤트에 함수 바인딩
     - 타임코드 값을 초 단위로 변환
     - 변환된 시간으로 미디어 플레이어 위치 설정

5. 타임코드 컴포넌트 설정
   - Role Mode: Automatic
   - Use nDisplay: 체크
   - Frame Rate: 미디어 프레임 레이트와 일치하도록 설정 (예: 29.97 또는 30)

6. 레벨에 BP_TimecodeMediaPlayer 배치
   - 레벨 에디터에서 콘텐츠 브라우저의 BP_TimecodeMediaPlayer 드래그 앤 드롭

7. nDisplay 클러스터로 프로젝트 실행

8. 결과 확인
   - 모든 노드에서 미디어 재생 위치가 동기화되는지 확인
   - 비디오 프레임이 모든 디스플레이에서 일치하는지 확인
   - 일시적인 네트워크 문제 후에도 동기화가 복구되는지 확인

## 고급 테스트: 타임코드 이벤트 시스템 (블루프린트)

**목적**: 타임코드 기반 이벤트가 모든 nDisplay 노드에서 동시에 트리거되는지 확인

**테스트 단계**:

1. 이벤트 블루프린트 생성
   - 새 액터 블루프린트 생성: "BP_TimecodeEvents"
   - 타임코드 컴포넌트 추가

2. 이벤트 정의 및 핸들러 구현
   - 이벤트 그래프에서 다음 로직 구현:
     
     ![타임코드 이벤트 시스템 블루프린트](https://i.ibb.co/RBs4qMm/timecode-events-bp.jpg)

   - 이 블루프린트는:
     - BeginPlay에서 여러 타임코드 이벤트 등록
     - 타임코드 이벤트 트리거 델리게이트에 함수 바인딩
     - 이벤트 발생 시 시각적 효과 생성 (파티클, 색상 변경 등)

3. 타임코드 컴포넌트 설정
   - Role Mode: Automatic
   - Use nDisplay: 체크
   - Auto Start: 체크

4. 레벨에 BP_TimecodeEvents 배치
   - 레벨 에디터에서 콘텐츠 브라우저의 BP_TimecodeEvents 드래그 앤 드롭
   - 이벤트 효과가 잘 보이도록 배치

5. 이벤트 효과 준비
   - 이벤트마다 다른 파티클 효과 또는 시각적 변화 설정
   - 사운드 효과 추가 (선택 사항)

6. nDisplay 클러스터로 프로젝트 실행

7. 결과 확인
   - 모든 노드에서 이벤트가 동시에 트리거되는지 확인
   - 이벤트 타이밍의 정확성 확인
   - 네트워크 지연이 이벤트 동기화에 미치는 영향 평가

## 문제 해결 (블루프린트 관점)

### 역할 감지 실패
- 디버깅 정보 출력을 위한 블루프린트 로직 추가:
  
  ![역할 감지 디버그 블루프린트](https://i.ibb.co/30FLt8y/role-detection-debug-bp.jpg)

- nDisplay 상태 확인 콘솔 명령어 사용:
  - 콘솔에 `nDisplay.status` 입력
  - 결과를 확인하여 노드 구성이 올바른지 확인

### 동기화 불일치
- PLL 파라미터 조정 블루프린트:
  
  ![PLL 파라미터 조정 블루프린트](https://i.ibb.co/nQJsm2L/pll-parameters-bp.jpg)

- 이 블루프린트는:
  - 타임코드 컴포넌트에서 PLL 매개변수 조정
  - 다양한 네트워크 환경에 맞게 최적화 가능

### 미디어 재생 동기화 문제
- 미디어 플레이어 로딩 상태 확인 블루프린트:
  
  ![미디어 로딩 상태 확인 블루프린트](https://i.ibb.co/sgBKTZt/media-loading-check-bp.jpg)

- 이 블루프린트는:
  - 미디어 플레이어의 로딩 상태 확인
  - 모든 노드에서 미디어가 완전히 로드된 후 동기화 시작

## 결론

블루프린트를 사용한 nDisplay 환경에서의 타임코드 플러그인 테스트는 코딩 지식 없이도 다중 디스플레이 시스템의 시간 동기화를 구현하고 검증할 수 있는 방법을 제공합니다. 이 가이드에 제시된 블루프린트 예제들을 기반으로 다양한 동기화 시나리오를 테스트할 수 있으며, 필요에 따라 블루프린트를 확장하여 더 복잡한 동기화 요구사항을 충족시킬 수 있습니다.
